<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.5">
    <title>–ú–∞—à–∏–Ω–∞ –¢—å—é—Ä–∏–Ω–≥–∞</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="machine" style="position: relative;"> <!--–û–±—ä—è–≤–∏–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –±–ª–æ—á–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –ú–∞—à–∏–Ω—ã –¢—å—é—Ä–∏–Ω–≥–∞-->
        <div class="alphabet-input-container"> <!--–û–±—ä—è–≤–∏–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –∞–ª—Ñ–∞–≤–∏—Ç–∞-->
            <label for="alphabet">–ê–ª—Ñ–∞–≤–∏—Ç (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):</label>
            <input type="text" id="alphabet" name="alphabet" value="_,0,1">
            <button onclick="updateAlphabet()">–û–±–Ω–æ–≤–∏—Ç—å –∞–ª—Ñ–∞–≤–∏—Ç</button>
        </div>

        <div class="tape-container"> <!--–û–±—ä—è–≤–∏–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –ª–µ–Ω—Ç—ã –ú–∞—à–∏–Ω—ã –¢—å—é—Ä–∏–Ω–≥–∞-->
            <div class="tape" id="tape"></div>
            <div class="head" id="head">‚ñº</div> 
        </div>

        <div class="controls"> <!--–û–±—ä—è–≤–∏–ª–∏ —ç–ª–µ–º–µ–Ω—Ç —Å –∫–Ω–æ–ø–∫–∞–º–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞—à–∏–Ω–æ–π-->
            <div class="controls-buttons">
                <button onclick="moveLeft()">‚óÑ</button>
                <button onclick="moveRight()">‚ñ∫</button>
                <!--<button onclick="step()">–®–∞–≥</button>
                <button onclick="run()">–ó–∞–ø—É—Å—Ç–∏—Ç—å</button>-->
				
				<button onclick="setTimeout(step, delay/2)">–®–∞–≥</button>
				<button onclick="setTimeout(run, delay/2)">–ó–∞–ø—É—Å—Ç–∏—Ç—å</button>				
				
                <button onclick="stopExecution()">–°—Ç–æ–ø</button>
                <button onclick="reset()">–°–±—Ä–æ—Å</button>
            </div>

            <div class="controls-state"> <!--–û–±—ä—è–≤–∏–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –±–ª–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–∞—à–∏–Ω—ã-->
                <div class="state"> 
                    –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: <span id="first_state">Q0</span>
        			<!-- <input type="text" id="first_state_input" value="q0"> -->
                </div>
                <div class="state">
                    <div class="state-container"> 
                        <label for="haltState">–ö–æ–Ω–µ—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:</label>
                        <input type="text" id="haltState" class="haltState" value="–∫–æ–Ω–µ—Ü">
                    </div>
                </div>
                <div class="state"> 
                    –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: <span id="state">Q0</span>
                </div>
            </div>
        </div>


        <div class="rules-container"> <!--–û–±—ä—è–≤–∏–ª–∏ —ç–ª–µ–º–µ–Ω—Ç, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Ç–∞–±–ª–∏—Ü—É –ø—Ä–∞–≤–∏–ª –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –ú–∞—à–∏–Ω—ã –¢—å—é—Ä–∏–Ω–≥–∞, –∞ —Ç–∞–∫ –∂–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–∞—à–∏–Ω—ã –≤ –≤–∏–¥–µ URL –∞–¥—Ä–µ—Å–∞-->
            <h3>–ü—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤</h3>
            <table id="rules-table">
                <thead>
                <tr>
                    <th>–°–æ—Å—Ç–æ—è–Ω–∏–µ</th>
                    <th>–°–∏–º–≤–æ–ª</th>
                    <th>–ù–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ</th>
                    <th>–ù–æ–≤—ã–π —Å–∏–º–≤–æ–ª</th>
                    <th>–î–≤–∏–∂–µ–Ω–∏–µ</th>
                    <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                </tr>
                </thead>
                <tbody>

                </tbody>
            </table>
            <button onclick="addRule()">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ</button>
            <!-- <button onclick="updateTransitions()">–û–±–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ—Ö–æ–¥—ã</button>-->
            <button onclick="generateAndShowLink()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ —Å—Å—ã–ª–∫—É</button>
          
          <button style="margin: 0 0px;" onclick="saveMachine()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ú–¢</button>
			<button style="margin: 0 0px 0 0px;" onclick="loadMachine()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ú–¢</button>          
               
          
          
        </div>
          <div id="linkContainer" style="margin-top: 20px; display: none;">
              <p>–°—Å—ã–ª–∫–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è:</p>
              <textarea id="linkText" rows="4" cols="80" readonly></textarea>
              <br>
              <button onclick="copyLink()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
          </div>

      
        <div style="margin-top: 20px;   margin-left: 30px;   display: flex;">
      
        </div>    
  
      
    </div>
  
  
  

  
  

    <script> //–û—Å–Ω–æ–≤–Ω–æ–π –±–ª–æ–∫ —Ä–∞–±–æ—Ç—ã JavaScript —Ñ—É–Ω–∫—Ü–∏–π
		const alphabetInput = document.getElementById('alphabet'); // –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ –∞–ª—Ñ–∞–≤–∏—Ç–∞
		const tapeContainer = document.querySelector('.tape-container'); // –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ª–µ–Ω—Ç—ã  
		const tapeElement = document.getElementById('tape'); // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –ª–µ–Ω—Ç—ã
		const head = document.getElementById('head'); // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –≥–æ–ª–æ–≤–∫–∏
		const haltStateInput = document.getElementById('haltState'); // –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ –∫–æ–Ω–µ—á–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
		const stateSpan = document.getElementById('state'); // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
		const first_state_Span = document.getElementById('first_state'); // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è		
		const rulesTable = document.getElementById('rules-table'); // –ü–æ–ª—É—á–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –ø—Ä–∞–≤–∏–ª
		var errorTransition = false;
		var delay = 750; // –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —à–∞–≥–∞–º–∏ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
			
		let alphabet = ['0', '1'];  
		let tape = [];      
		let headPosition = 0;
		let currentState = 'q0';
		let haltState = '–∫–æ–Ω–µ—Ü';
		let transitions = [];
		let isRunning = false; 
		
		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ URL
		function getUrlParams() {
			const urlParams = new URLSearchParams(window.location.search);
			const params = {};
			for (const [key, value] of (urlParams)) {
				params[key] = value;
			}
			return params;
		}
		

      // –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ URL
        const urlParams = getUrlParams();

        // –ê–ª—Ñ–∞–≤–∏—Ç
        if (urlParams.alphabet) {
            alphabet = urlParams.alphabet.split('');
            alphabetInput.value = alphabet.join(',');
        }

        // –ü–æ–∑–∏—Ü–∏—è –≥–æ–ª–æ–≤–∫–∏
        if (urlParams.headPosition) {
            headPosition = parseInt(urlParams.headPosition);
        }

        // –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ–≥–¥–∞ q0
        let firstState = 'q0';
        currentState = firstState;
        updateState(currentState);
        first_state_Span.textContent = firstState;

        // –ö–æ–Ω–µ—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        if (urlParams.haltState) {
            haltState = urlParams.haltState;
            haltStateInput.value = haltState;
        } else {
            haltState = haltStateInput.value;
        }

        // –õ–µ–Ω—Ç–∞
        if (urlParams.tape) {
            tape = urlParams.tape.split('');
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –∞–ª—Ñ–∞–≤–∏—Ç
        updateAlphabet();

		
		if (urlParams.tape) {
			tape = urlParams.tape.split('');
			while(tapeElement.children.length < tape.length){
				const item = document.createElement('div');
				item.classList.add('item');
				const select = createSelectElement(alphabet[0]);
				item.appendChild(select);
				tapeElement.appendChild(item);
			}
		
			for (let i = 0; i < tape.length; i++) {
				updateTapeCell(i, tape[i]);
			}
		
		} else {
			initializeTape();
		}
		
		updateHeadPosition();
		
		if (urlParams.state) {
			transitions = parseTransitions(decodeURIComponent(urlParams.state));
			updateRulesTable(transitions);
		} else {
			transitions = [
				{ state: 'q0', symbol: '0', newState: 'q1', newSymbol: '1', direction: 'R' },
				{ state: 'q0', symbol: '1', newState: 'q0', newSymbol: '1', direction: 'R' },
				{ state: 'q1', symbol: '1', newState: 'q1', newSymbol: '0', direction: 'L' },
				{ state: 'q1', symbol: '0', newState: 'q1', newSymbol: '0', direction: 'N' }
			];
			updateRulesTable(transitions);
		}
		
		// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–ª—Ñ–∞–≤–∏—Ç–∞
		function updateAlphabet() {
			alphabet = alphabetInput.value.split(',').map(item => item.trim());
			initializeTape();
			const rows = rulesTable.querySelectorAll('tbody tr');
			rows.forEach(row => {
				const symbolSelect = row.querySelector('.symbol-select');
				const newSymbolSelect = row.querySelector('.new-symbol-select');
				updateSymbolSelect(symbolSelect);
				updateSymbolSelect(newSymbolSelect);
			});
		}
		
		// –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞ select –¥–ª—è —è—á–µ–π–∫–∏ –ª–µ–Ω—Ç—ã
		function createSelectElement(selectedValue) {
			const select = document.createElement('select');
			select.classList.add('cell-select');
			alphabet.forEach(symbol => {
				const option = document.createElement('option');
				option.value = symbol;
				option.textContent = symbol;
				select.appendChild(option);
			});
			select.value = selectedValue || alphabet[0];
			select.addEventListener('change', (event) => {
				tape[Array.from(tapeElement.children).indexOf(event.target.parentNode)] = event.target.value;
			});
			return select;
		}
		
		// –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ª–µ–Ω—Ç—ã
		function initializeTape() {
			tapeElement.innerHTML = '';
			tape = [];
			for (let i = 1; i < 20; i++) {
				const item = document.createElement('div');
				item.classList.add('item');
				const select = createSelectElement(alphabet[0]);
				item.appendChild(select);
				tapeElement.appendChild(item);
				tape.push(alphabet[0]);
			}
			updateHeadPosition();
		}
		
		// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —è—á–µ–π–∫–∏ –ª–µ–Ω—Ç—ã
		function updateTapeCell(index, value) {
			const tapeCells= tapeElement.querySelectorAll('.item'); // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –≤–Ω—É—Ç—Ä–∏ tapeElement
			if (tapeCells[index]) {
				const selectElement = tapeCells[index].querySelector('.cell-select');
				if (selectElement) {
					selectElement.value = value;
					tape[index] = value; // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –º–∞—Å—Å–∏–≤–µ tape
					console.log(`–Ø—á–µ–π–∫–∞ ${index+1} –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ–º ${value}`);
				} else {
					console.warn(`Select element –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —è—á–µ–π–∫–µ ${index+1}`);
				}
			} else {
				console.warn(`–Ø—á–µ–π–∫–∞ ${index+1} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞`);
			}
		}
		
		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π –¥–ª–∏–Ω—ã –ª–µ–Ω—Ç—ã
		function ensureTapeLength() {
			if (headPosition >= tape.length) {
				const item = document.createElement('div');
				item.classList.add('item');
				const select = createSelectElement();
				item.appendChild(select);
				tapeElement.appendChild(item);
				tape.push(select.value);
			}
		}
		
		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
		function updateState(newState) {
			currentState= newState;
			stateSpan.textContent = newState;
		}
		
		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –≥–æ–ª–æ–≤–∫–∏ –ª–µ–Ω—Ç—ã –≤–ª–µ–≤–æ
		function moveLeft() {
			if (headPosition > 0) {headPosition--;
				updateHeadPosition();
			}
		}
		
		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –≥–æ–ª–æ–≤–∫–∏ –ª–µ–Ω—Ç—ã –≤–ø—Ä–∞–≤–æ
		function moveRight() {
			headPosition++;
			ensureTapeLength();
			updateHeadPosition();
		}
		
		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ –≥–æ–ª–æ–≤–∫–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ª–µ–Ω—Ç—ã
		function updateHeadPosition() {
			let cellWidth = 40; // –°—Ç–∞—Ç–∏—á–Ω–∞—è —à–∏—Ä–∏–Ω–∞ —è—á–µ–π–∫–∏ –ª–µ–Ω—Ç—ã, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–∞–∑–º–µ—Ä—É –≤ CSS
			if (window.innerWidth <= 600) {
				cellWidth = 30;
			}
			const headLeft = headPosition * cellWidth+8.5; // –í—ã—á–∏—Å–ª—è–µ–º –ø–æ–ª–æ–∂–µ–Ω–∏–µ –≥–æ–ª–æ–≤–∫–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ª–µ–Ω—Ç—ã
			head.style.left = `${headLeft}px`;
			scrollToVisible(); // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ –≥–æ–ª–æ–≤–∫–∏
		
		}
		
		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–∫—Ä–æ–ª–ª–∞ –ª–µ–Ω—Ç—ã, –≤ —Å–ª—É—á–∞–µ –µ—Å–ª–∏ –≥–æ–ª–æ–≤–∫–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –≤–∏–¥–∏–º–æ–π —á–∞—Å—Ç–∏ –ª–µ–Ω—Ç—ã
		function scrollToVisible() {
			const cellWidth = 40;
			const containerWidth = tapeContainer.offsetWidth;
			const scrollLeft = tapeContainer.scrollLeft;
			const headLeft = (headPosition* cellWidth); // –ü–æ–ª–æ–∂–µ–Ω–∏–µ –≥–æ–ª–æ–≤–∫–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ª–µ–Ω—Ç—ã
			const visibleRight = scrollLeft + containerWidth; // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–∞–≤—É—é –≥—Ä–∞–Ω–∏—Ü—É –≤–∏–¥–∏–º–æ–π –æ–±–ª–∞—Å—Ç–∏ –ª–µ–Ω—Ç—ã
			if (headLeft + cellWidth > visibleRight) {
				tapeContainer.scrollTo({
					left: headLeft - containerWidth + (1.5 * cellWidth),
					behavior: 'smooth'
				}); // –ï—Å–ª–∏ –≥–æ–ª–æ–≤–∫–∞ –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –ø—Ä–∞–≤—É—é –≥—Ä–∞–Ω–∏—Ü—É –ª–µ–Ω—Ç—ã, –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –ª–µ–Ω—Ç—É
			}
			else if (headLeft < scrollLeft) {
				tapeContainer.scrollTo({
					left: headLeft,
					behavior: 'smooth'
				}); // –ï—Å–ª–∏ –≥–æ–ª–æ–≤–∫–∞ —É—Ö–æ–¥–∏—Ç –∑–∞ –ª–µ–≤—É—é –≥—Ä–∞–Ω–∏—Ü—É —Ç–æ–∂–µ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º
			}
		}
		
		// –§—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ —à–∞–≥–∞ –º–∞—à–∏–Ω—ã –¢—å—é—Ä–∏–Ω–≥–∞
		function step() {
			updateTransitions();
			const currentSymbol = tape[headPosition];
			const transition = transitions.find(t => t.state === currentState && t.symbol === currentSymbol);
			if (transition) {
				const { newState, newSymbol, direction } = transition;
				tape[headPosition] = newSymbol;
				updateState(newState);
				updateTapeCell(headPosition, newSymbol);
				if (direction === 'R') {
					moveRight();
				} else if (direction === 'L') {
					moveLeft();
				} else if (direction === 'N') {
				}
			} else {
				errorTransition = true;
				console.log(`–ü–µ—Ä–µ—Ö–æ–¥ –ø—Ä–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ '${currentState}' –∏ —Å–∏–º–≤–æ–ª–µ '${currentSymbol}' –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Äî –º–∞—à–∏–Ω–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞.`);
				isRunning = false;
			}
		}
		
		// –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∞—à–∏–Ω—ã –¢—å—é—Ä–∏–Ω–≥–∞
		function run() {
		updateTransitions();
			if (isRunning) return; // –ï—Å–ª–∏ —É–∂–µ –∑–∞–ø—É—â–µ–Ω–æ, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
			isRunning = true;
			haltState = haltStateInput.value;
			let steps = 0;
			const maxSteps = 1000;
			function executeStep() {
				if (isRunning && currentState !== haltState && headPosition < tape.length && steps < maxSteps) {
				    if (errorTransition) {
						console.log(`–ú–∞—à–∏–Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞. –û–±–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ—Ö–æ–¥—ã`);
						return;
					}
					step();		console.log("–≤—ã–∑–æ–≤ Step");
					steps++;
		
					if (currentState !== haltState) {
						setTimeout(executeStep, delay); // –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –≤—ã–∑–æ–≤ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
					} else {
						console.log("–ú–∞—à–∏–Ω–∞ –¢—å—é—Ä–∏–Ω–≥–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞ —Ä–∞–±–æ—Ç—É.");
						isRunning = false; // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –µ—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ –∫–æ–Ω–µ—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
					}
				} else {
					isRunning = false; // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –µ—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã —É—Å–ª–æ–≤–∏—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
					if (steps === maxSteps) {
						console.warn("–ú–∞—à–∏–Ω–∞ –¢—å—é—Ä–∏–Ω–≥–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∏–∑-–∑–∞ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —à–∞–≥–æ–≤.");
					}
				}
			}
		
			executeStep(); // –ù–∞—á–∞–ª–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
		}
		
		// –§—É–Ω–∫—Ü–∏—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∞—à–∏–Ω—ã –¢—å—é—Ä–∏–Ω–≥–∞
		function stopExecution() {
			isRunning = false;
			console.log("–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.");
		}
		
		// –§—É–Ω–∫—Ü–∏—è —Å–±—Ä–æ—Å–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–∞—à–∏–Ω—ã –¢—å—é—Ä–∏–Ω–≥–∞
		function reset() {
			headPosition = 0;
			currentState = 'q0';
			updateState(currentState);
			updateHeadPosition();
			initializeTape();
		}
		
		// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ —Å–∏–º–≤–æ–ª–æ–≤
		function updateSymbolSelect(select, selectedValue) {
			select.innerHTML = '';
			alphabet.forEach(symbol => {
				const option = document.createElement('option');
				option.value = symbol;
				option.textContent = symbol;
				select.appendChild(option);
			});
		
			if (selectedValue && alphabet.includes(selectedValue)) {
				select.value = selectedValue;
			} else {
				select.value = alphabet[0];
			}
		}
		
		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞
		function addRule() {
			const tbody = rulesTable.querySelector('tbody');
			const newRow = tbody.insertRow();
			newRow.innerHTML = `
				<td><input type="text"></td>
				<td><select class="symbol-select"></select></td>
				<td><input type="text"></td>
				<td><select class="new-symbol-select"></select></td>
				<td>
					<select>
						<option value="R">R</option>
						<option value="L">L</option>
						<option value="N">N</option>
					</select>
				</td>
				<td><button onclick="deleteRule(this)">–£–¥–∞–ª–∏—Ç—å</button></td>
			`;
			const symbolSelect = newRow.querySelector('.symbol-select');
			const newSymbolSelect = newRow.querySelector('.new-symbol-select');
			updateSymbolSelect(symbolSelect);
			updateSymbolSelect(newSymbolSelect); // –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç—É –∂–µ —Ñ—É–Ω–∫—Ü–∏—é
		}
		
		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞
		function deleteRule(button) {
			const row = button.parentNode.parentNode;
			rulesTable.deleteRow(row.rowIndex);
			updateTransitions()
		}
		
		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å—Ç—Ä–æ–∫–∏ –ø—Ä–∞–≤–∏–ª –≤ –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ transitions
		function parseTransitions(rulesString) {
			const transitions = [];
			if (!rulesString) return transitions;
			const ruleSets = rulesString.split('->');
		
			ruleSets.forEach(ruleSet => {
				if (!ruleSet) return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
				const parts = ruleSet.split('|');
				if (parts.length !== 5) {
					console.warn("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –ø—Ä–∞–≤–∏–ª–∞:", ruleSet);
					return;
				}
				const [state, symbol, newState, newSymbol, direction] = parts;
				transitions.push({
					state: state,
					symbol: symbol,
					newState: newState,
					newSymbol: newSymbol,
					direction: direction
				});
			});
		
			return transitions;
		}
		
		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤(–∏–∑ —Ç–∞–±–ª–∏—Ü—ã –≤ –º–∞—Å—Å–∏–≤ transitions)
		function updateTransitions() {
			errorTransition = false;
			transitions = [];
			const rows = rulesTable.querySelectorAll('tbody tr');
			rows.forEach(row => {
				const cells = row.querySelectorAll('td');
				if (cells.length > 0) {
					const state = cells[0].querySelector('input').value;
					const symbol = cells[1].querySelector('select').value;
					const newState = cells[2].querySelector('input').value;
					const newSymbol = cells[3].querySelector('select').value;
					const direction = cells[4].querySelector('select').value;
					
					transitions.push({
						state: state,
						symbol: symbol,
						newState: newState,
						newSymbol: newSymbol,
						direction: direction
					});
				}
			});
			console.log('Transitions updated:', transitions);
		}
		
		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–∞–≤–∏–ª –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–∞—Å—Å–∏–≤–∞ transitions
		function updateRulesTable(transitions) {
			// –û—á–∏—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç—Ä–æ–∫–∏ (–∫—Ä–æ–º–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞)
			const tbody = rulesTable.querySelector('tbody');
			tbody.innerHTML = '';
			transitions.forEach(transition => {
				const newRow = tbody.insertRow();
				newRow.innerHTML = `
					<td><input type="text" value="${transition.state}"></td>
					<td><select class="symbol-select"></select></td>
					<td><input type="text" value="${transition.newState}"></td>
					<td><select class="new-symbol-select"></select></td>
					<td>
						<select>
							<option value="R" ${transition.direction === 'R' ? 'selected' : ''}>R</option>
							<option value="L" ${transition.direction === 'L' ? 'selected' : ''}>L</option>
							<option value="N" ${transition.direction === 'N' ? 'selected' : ''}>N</option>
			</select>
					</td>
					<td><button onclick="deleteRule(this)">–£–¥–∞–ª–∏—Ç—å</button></td>
				`;
				const symbolSelect = newRow.querySelector('.symbol-select');
				const newSymbolSelect = newRow.querySelector('.new-symbol-select');
				updateSymbolSelect(symbolSelect, transition.symbol);
				updateSymbolSelect(newSymbolSelect, transition.newSymbol); // –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç—É –∂–µ —Ñ—É–Ω–∫—Ü–∏—é
		
			});
		}
		
        // –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        function generateAndShowLink() {
            updateTransitions(); // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º

            const baseUrl = window.location.origin + window.location.pathname;
            const alphabetParam = alphabet.join('');
            const headPositionParam = headPosition;
            const firstStateParam = 'q0'; // <-- —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            const haltStateParam = haltStateInput.value;
            const tapeParam = tape.join('');

            const rulesString = transitions
                .map(t => `${t.state}|${t.symbol}|${t.newState}|${t.newSymbol}|${t.direction}`)
                .join('->');

            // —Å–æ—Ö—Ä–∞–Ω—è–µ–º firstState, currentState –Ω–µ –≤–∫–ª—é—á–∞–µ–º
            const url = `${baseUrl}?alphabet=${alphabetParam}&headPosition=${headPositionParam}&firstState=${firstStateParam}&haltState=${haltStateParam}&tape=${tapeParam}&state=${rulesString}`;

            const linkTextarea = document.getElementById('linkText');
            linkTextarea.value = url;
            document.getElementById('linkContainer').style.display = 'block';
        }


      function saveMachine() {
          updateTransitions();

          // –°–æ–±–∏—Ä–∞–µ–º —Ç–µ–∫—É—â—É—é –ª–µ–Ω—Ç—É –∏–∑ DOM
          const tapeCells = tapeElement.querySelectorAll('.item .cell-select');
          const fullTape = Array.from(tapeCells).map(cell => cell.value);

          const data = {
              alphabet,
              tape: fullTape,   // —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å—é –ª–µ–Ω—Ç—É, –≤–∫–ª—é—á–∞—è –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏
              headPosition,
              currentState,
              haltState: haltStateInput.value,
              transitions
          };
          localStorage.setItem("savedMT", JSON.stringify(data));
          alert("‚úÖ –ú–∞—à–∏–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ localStorage.");
      }


      function loadMachine() {
          const json = localStorage.getItem("savedMT");
          if (!json) {
              alert("‚ö†Ô∏è –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–π –º–∞—à–∏–Ω—ã –≤ localStorage.");
              return;
          }

          const data = JSON.parse(json);
          alphabet = data.alphabet;
          tape = data.tape;
          headPosition = data.headPosition;
          currentState = data.currentState;
          haltState = data.haltState;
          transitions = data.transitions;

          alphabetInput.value = alphabet.join(',');
          haltStateInput.value = haltState;
          updateRulesTable(transitions);

          tapeElement.innerHTML = '';
          for (let i = 0; i < tape.length; i++) {
              const item = document.createElement('div');
              item.classList.add('item');
              const select = createSelectElement(tape[i]);
              item.appendChild(select);
              tapeElement.appendChild(item);
          }

          updateHeadPosition();
          updateState(currentState);
          alert("‚úÖ –ú–∞—à–∏–Ω–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–∑ localStorage.");
      }

      function copyLink() {
          const link = document.getElementById('linkText').value;
          navigator.clipboard.writeText(link).then(() => {
              alert('‚úÖ –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
          }).catch(() => {
              alert('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É.');
          });
      }

      
    </script>
</body>
</html>